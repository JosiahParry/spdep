<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Construct neighbours list from polygon list — poly2nb • spdep</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Construct neighbours list from polygon list — poly2nb" />

<meta property="og:description" content="The function builds a neighbours list based on regions with contiguous boundaries, that is sharing one or more boundary point. The current function is in part interpreted and may run slowly for many regions or detailed boundaries, but from 0.2-16 should not fail because of lack of memory when single polygons are built of very many border coordinates." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spdep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/CO69.html">“The Problem of Spatial Autocorrelation:” forty years on</a>
    </li>
    <li>
      <a href="../articles/nb_igraph.html">Spatial weights objects as sparse matrices and graphs</a>
    </li>
    <li>
      <a href="../articles/nb_sf.html">Creating Neighbours using sf objects</a>
    </li>
    <li>
      <a href="../articles/sids.html">Introduction to the North Carolina SIDS data set (re-revised)</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-spatial/spdep">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Construct neighbours list from polygon list</h1>
    
    <div class="hidden name"><code>poly2nb.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>The function builds a neighbours list based on regions with contiguous boundaries, that is sharing one or more boundary point. The current function is in part interpreted and may run slowly for many regions or detailed boundaries, but from 0.2-16 should not fail because of lack of memory when single polygons are built of very many border coordinates.</p>
    
    </div>

    <pre class="usage"><span class='fu'>poly2nb</span>(<span class='no'>pl</span>, <span class='kw'>row.names</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>snap</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/MathFun'>sqrt</a></span>(<span class='no'>.Machine</span>$<span class='no'>double.eps</span>),
 <span class='kw'>queen</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>useC</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>foundInBox</span><span class='kw'>=</span><span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>pl</th>
      <td><p>list of polygons of class extending <code>SpatialPolygons</code>, or an <code>sf</code> or <code>sfc</code> object containing non-empty (multi-)polygon objects</p></td>
    </tr>
    <tr>
      <th>row.names</th>
      <td><p>character vector of region ids to be added to the neighbours list as attribute <code>region.id</code>, default <code><a href='https://www.rdocumentation.org/packages/base/topics/seq'>seq(1, nrow(x))</a></code>; if <code>polys</code> has a <code>region.id</code> attribute, it is copied to the neighbours list.</p></td>
    </tr>
    <tr>
      <th>snap</th>
      <td><p>boundary points less than <code>snap</code> distance apart are considered to indicate contiguity</p></td>
    </tr>
    <tr>
      <th>queen</th>
      <td><p>if TRUE, a single shared boundary point meets the contiguity condition, if FALSE, more than one shared point is required; note that more than one shared boundary point does not necessarily mean a shared boundary line</p></td>
    </tr>
    <tr>
      <th>useC</th>
      <td><p>default TRUE, doing the work loop in C, may be set to false to revert to R code calling two C functions in an <code>n*k</code> work loop, where <code>k</code> is the average number of candidate neighbours</p></td>
    </tr>
    <tr>
      <th>foundInBox</th>
      <td><p>default NULL using R code, possibly parallelised if a <span class="pkg">snow</span> cluster is available, otherwise a list of length <code>(n-1)</code> with integer vectors of candidate neighbours <code>(j &gt; i)</code>, or NULL if all candidates were <code>(j &lt; i)</code> (as created by the <code>poly_findInBoxGEOS</code> function in <span class="pkg">rgeos</span> for clean polygons)</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A neighbours list with class <code>nb</code>. See <code><a href='card.html'>card</a></code> for details of &#8220;nb&#8221; objects.</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>From 0.5-8, the function includes faster bounding box indexing and other improvements contributed by Micah Altman. If a cluster is provided using <code>set.ClusterOption</code>, it will be used for finding candidate bounding box overlaps for exact testing for contiguity.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='summary.nb.html'>summary.nb</a></code>, <code><a href='card.html'>card</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>columbus</span> <span class='kw'>&lt;-</span> <span class='fu'>st_read</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"shapes/columbus.shp"</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"spData"</span>)[<span class='fl'>1</span>], <span class='kw'>quiet</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='no'>col.gal.nb</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='read.gal.html'>read.gal</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"weights/columbus.gal"</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"spData"</span>)[<span class='fl'>1</span>])
<span class='no'>coords</span> <span class='kw'>&lt;-</span> <span class='fu'>st_coordinates</span>(<span class='fu'>st_centroid</span>(<span class='fu'>st_geometry</span>(<span class='no'>columbus</span>)))
<span class='no'>xx</span> <span class='kw'>&lt;-</span> <span class='fu'>poly2nb</span>(<span class='fu'>as</span>(<span class='no'>columbus</span>, <span class='st'>"Spatial"</span>))
<span class='no'>dxx</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='diffnb.html'>diffnb</a></span>(<span class='no'>xx</span>, <span class='no'>col.gal.nb</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='fu'>st_geometry</span>(<span class='no'>columbus</span>), <span class='kw'>border</span><span class='kw'>=</span><span class='st'>"grey"</span>)</div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>col.gal.nb</span>, <span class='no'>coords</span>, <span class='kw'>add</span><span class='kw'>=</span><span class='fl'>TRUE</span>)</div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>dxx</span>, <span class='no'>coords</span>, <span class='kw'>add</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>col</span><span class='kw'>=</span><span class='st'>"red"</span>)</div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/title'>title</a></span>(<span class='kw'>main</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/paste'>paste</a></span>(<span class='st'>"Differences (red) in Columbus GAL weights (black)"</span>,
 <span class='st'>"and polygon generated queen weights"</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>"\n"</span>), <span class='kw'>cex.main</span><span class='kw'>=</span><span class='fl'>0.6</span>)</div><div class='img'><img src='poly2nb-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># poly2nb with sf sfc_MULTIPOLYGON objects</span>
<span class='no'>sf_xx</span> <span class='kw'>&lt;-</span> <span class='fu'>poly2nb</span>(<span class='no'>columbus</span>)
<span class='fu'><a href='diffnb.html'>diffnb</a></span>(<span class='no'>sf_xx</span>, <span class='no'>xx</span>)</div><div class='output co'>#&gt; Neighbour list object:
#&gt; Number of regions: 49 
#&gt; Number of nonzero links: 0 
#&gt; Percentage nonzero weights: 0 
#&gt; Average number of links: 0 
#&gt; 49 regions with no links:
#&gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49</div><div class='input'><span class='no'>sfc_xx</span> <span class='kw'>&lt;-</span> <span class='fu'>poly2nb</span>(<span class='fu'>st_geometry</span>(<span class='no'>columbus</span>))
<span class='fu'><a href='diffnb.html'>diffnb</a></span>(<span class='no'>sfc_xx</span>, <span class='no'>xx</span>)</div><div class='output co'>#&gt; Neighbour list object:
#&gt; Number of regions: 49 
#&gt; Number of nonzero links: 0 
#&gt; Percentage nonzero weights: 0 
#&gt; Average number of links: 0 
#&gt; 49 regions with no links:
#&gt; 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49</div><div class='input'><span class='no'>xxx</span> <span class='kw'>&lt;-</span> <span class='fu'>poly2nb</span>(<span class='fu'>as</span>(<span class='no'>columbus</span>, <span class='st'>"Spatial"</span>), <span class='kw'>queen</span><span class='kw'>=</span><span class='fl'>FALSE</span>)
<span class='no'>dxxx</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='diffnb.html'>diffnb</a></span>(<span class='no'>xxx</span>, <span class='no'>col.gal.nb</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='fu'>st_geometry</span>(<span class='no'>columbus</span>), <span class='kw'>border</span> <span class='kw'>=</span> <span class='st'>"grey"</span>)</div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>col.gal.nb</span>, <span class='no'>coords</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>dxxx</span>, <span class='no'>coords</span>, <span class='kw'>add</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='st'>"red"</span>)</div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/title'>title</a></span>(<span class='kw'>main</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/paste'>paste</a></span>(<span class='st'>"Differences (red) in Columbus GAL weights (black)"</span>,
 <span class='st'>"and polygon generated rook weights"</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>"\n"</span>), <span class='kw'>cex.main</span><span class='kw'>=</span><span class='fl'>0.6</span>)</div><div class='img'><img src='poly2nb-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='no'>cards</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='card.html'>card</a></span>(<span class='no'>xx</span>)
<span class='no'>maxconts</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/which'>which</a></span>(<span class='no'>cards</span> <span class='kw'>==</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Extremes'>max</a></span>(<span class='no'>cards</span>))
<span class='kw'>if</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/length'>length</a></span>(<span class='no'>maxconts</span>) <span class='kw'>&gt;</span> <span class='fl'>1</span>) <span class='no'>maxconts</span> <span class='kw'>&lt;-</span> <span class='no'>maxconts</span>[<span class='fl'>1</span>]
<span class='no'>fg</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/rep'>rep</a></span>(<span class='st'>"grey"</span>, <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/length'>length</a></span>(<span class='no'>cards</span>))
<span class='no'>fg</span>[<span class='no'>maxconts</span>] <span class='kw'>&lt;-</span> <span class='st'>"red"</span>
<span class='no'>fg</span>[<span class='no'>xx</span><span class='kw'>[[</span><span class='no'>maxconts</span>]]] <span class='kw'>&lt;-</span> <span class='st'>"green"</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='fu'>st_geometry</span>(<span class='no'>columbus</span>), <span class='kw'>col</span><span class='kw'>=</span><span class='no'>fg</span>)</div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/title'>title</a></span>(<span class='kw'>main</span><span class='kw'>=</span><span class='st'>"Region with largest number of contiguities"</span>, <span class='kw'>cex.main</span><span class='kw'>=</span><span class='fl'>0.6</span>)</div><div class='img'><img src='poly2nb-3.png' alt='' width='700' height='433' /></div><div class='input'><span class='no'>nc.sids</span> <span class='kw'>&lt;-</span> <span class='fu'>st_read</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"shapes/sids.shp"</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"spData"</span>)[<span class='fl'>1</span>], <span class='kw'>quiet</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.time'>system.time</a></span>(<span class='no'>xxnb</span> <span class='kw'>&lt;-</span> <span class='fu'>poly2nb</span>(<span class='no'>nc.sids</span>))</div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.028   0.000   0.032 </div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.time'>system.time</a></span>(<span class='no'>xxnb</span> <span class='kw'>&lt;-</span> <span class='fu'>poly2nb</span>(<span class='fu'>as</span>(<span class='no'>nc.sids</span>, <span class='st'>"Spatial"</span>)))</div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.045   0.000   0.049 </div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='fu'>st_geometry</span>(<span class='no'>nc.sids</span>))</div><div class='input'><span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>xxnb</span>, <span class='fu'>coordinates</span>(<span class='fu'>as</span>(<span class='no'>nc.sids</span>, <span class='st'>"Spatial"</span>)), <span class='kw'>add</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>col</span><span class='kw'>=</span><span class='st'>"blue"</span>)</div><div class='img'><img src='poly2nb-4.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Roger Bivand <a href='mailto:Roger.Bivand@nhh.no'>Roger.Bivand@nhh.no</a> with contributions from Micah Altman</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

